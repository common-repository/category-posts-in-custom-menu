=== Category Posts in Custom Menu ===
Contributors: anaid
Donate link: https://wordpress.telodelic.nl/category-posts-in-custom-menu
Tags: menu, submenu, category, dynamic, automatic
License: GPL-2.0-or-later
Requires at least: 4.9.23
Tested up to: 6.6
Requires PHP: 7.4
Stable Tag: 3.0.2

Dynamic menus: List all posts from a category in your menu. Also works for tags, custom taxonomies as well as pages and custom post types.

== Description ==

The default custom menu in WordPress only allows adding a <i>link</i> that leads to a list of posts and pages belonging to a taxonomy (category, tag, etc). If you want to list the posts and pages <b>themselves</b> and if you want Wordpress to do this automatically for you, then I hope you will find this plugin useful.

<strong>Also works for custom taxonomies and custom post types</strong>
<strong>NEW: CPCM V3 now provides support for Full Site Editing with the Gutenberg Block Editor</strong>
<strong>WARNING: Coming from version 1.x? There are breaking changes, read the changelog before upgrading.</strong>

= Using it =
Enable the plugin and go to either Appearance > Menus or Appearance > Customize or Appearance > Editor. Add a category (or other taxonomy like tag or custom) to the menu. Next, you can choose if you would like to replace the category by the posts or pages themselves.

For each Category in your menu, you now have the following extra configuration options: 

* Replace by posts in the category y/n; 
* specify the (maximum) number of posts you want to show for this item (max 10);
* their ordering ascending or descending by Title, Date or Menu Order;
* specify the title for the menu items. For this you can use %post_title, %post_author and other wildcards, see 'Other Notes > Wildcards'. Default value: %post_title

= Wildcards =

You can control the title of the menu items generated by the plug-in with the following wildcards:

* %post_title
* %post_author
* %post_date for the unformatted post date: 2012-11-10 18:14:23
* %post_date() for a formatted post date with the following default formatting: November 10th, 2012
* %post_date(&lt;your formatting here&gt;) for custom date formatting. Example: %post_date(l jS \of F Y, h:i:s A). See <a href="http://codex.wordpress.org/Formatting_Date_and_Time">http://codex.wordpress.org/Formatting_Date_and_Time</a> for formatting options.
* %post_date_gmt
* %post_date_gmt()
* %post_date_gmt(&lt;your formatting here&gt;)

== Screenshots ==

1. Go to Appearance > Menu to enable/disable and set the options for the replacement of Category / Post Tag links by their posts.
2. Go to Appearance > Customize to enable/disable and set the options for the replacement of Category / Post Tag links by their posts. (Requires WordPress 5.4 or higher)
3. Go to Appearance > Editor to enable/disable and set the options for the replacement of Category / Post Tag links by their posts. (Requires WordPress 6.1 or higher)

== Upgrade Notice ==

= 3.0.0 = 

Now provides support for Full Site Editing with the Gutenberg Block Editor.
Dropped support for Wordpress 4.x, plugin now requires WordPress 5.4 or higher.
Verified compatibility with WordPress 6.5

= 2.0.0 = 

<strong>WARNING: Version 2.0 has breaking changes! See changelog.</strong>

Now compatible with Wordpress 6.2. Important: Plugin has been split into a Free and a Premium version. The Free version now has more limited functionality. See Changelog.

== Changelog ==

= 3.0.2 = 

Verified compatibility with WordPress 6.6

= 3.0.0 = 

Now provides support for Full Site Editing with the Gutenberg Block Editor.
Dropped support for Wordpress 4.x, plugin now requires WordPress 5.4 or higher.
Verified compatibility with WordPress 6.5

= 2.1.2 = 

Verified compatibility with Wordpress 6.4.

= 2.1.1 = 

Free version now also supports sorting by Menu Order.

= 2.1.0 = 

Verified compatibility with Wordpress 6.3.
Also re-verified compatibility with older versions: Tested against 4.9.23 and 5.9.7

New functionality: 

* Menus can now also be managed via Appearance > Customize (Requires WordPress 5.4 or higher)

= 2.0.0 = 

<strong>WARNING: Version 2.0 has breaking changes! See changelog.</strong>

Bugfix: On some mobile themes, the dropdown caret did not show. (As reported here: https://wordpress.org/support/topic/mobile-sub-menu-3/, and here: https://wordpress.org/support/topic/not-working-on-mobile-devices-16/)

Split Free and Premium version:

* Premium has extra wildcards that Free doesn't have.
* Premium allows expanding unlimited posts; Free is limited to 10 posts.
* Premium allows preserving the original menu item; Free always removes the category to replace it by the posts below it.
* Premium allows filtering out the subcategories; Free always returns posts in subcategories when the parent category is selected
* Premium supports HTML in the label field; Free only supports plaintext.
* Premium offers hooks to extend the plugin functionality; Free does not.

= 1.3.0 = 

Now compatible with WordPress 5.7.
If you are on a WordPress version between 4.7 and 5.7.2, when encountering issues please report the WordPress version you're running.

= 1.2.4 =

* Rename __empty to custom_empty to suppress PHP 7.0 validation warning as reported here: https://wordpress.org/support/topic/php-7-compability-2/
* Add another sample extension (from github)
* Update readme to reflect that it's PHP7.0 compatible, as mentioned here: https://wordpress.org/support/topic/php-7-compability-2/

= 1.2.3 =

* Hide the options when 'Create submenu ...' is not checked, thanks for contribution by websevendev
* Fix compatibility issue with 4.7, resulting in options not being shown.

= 1.2.2 =

* Allow users to plug-in their own wildcards to facilitate https://wordpress.org/support/topic/show-category-post_category?replies=3
* Edit readme to explain usage of the custom wp_nav_menu_item_custom_fields that several plugin authors have been using.
* Add example implementation to the sample extension that shows how to extend the CSS classes of the menu items
* Unit tests

= 1.2.1 =

* Only commit meta data for menu items that actually had a CPCM checkbox, reported here https://wordpress.org/support/topic/undefined-index-56
* Set default skip parameter to 0, as reported here https://wordpress.org/support/topic/posts-assigned-to-more-than-one-category-are-not-listed-correctly?replies=3

= 1.2.0 =

* Fixed serious bug in versioning, which resulted in version 1.1 having no settings at all anymore. This fix has been tested with both both the upgrade path 1.0.1 -> 1.2 and upgrade path 1.0.1 -> 1.1 -> 1.2, both upgrade paths should be fined now. My sincere apologies to all who experienced this issue.
* Fixed debug errors as reported here https://wordpress.org/support/topic/undefined-index-56?replies=7

= 1.1 =

* Process custom fields last, so that users cannot override the built-in options like %post_featured_image with a custom field named "featured_image". As reported here https://wordpress.org/support/topic/category-lastes-post-with-images?replies=7#post-7052239
* Allow others to extend my CPCM plugin with their own fields. Also includes a sample that shows how to do this. https://wordpress.org/support/topic/exclude-single-posts?replies=5
* Some comments and code formatting
* Introduced plugin versioning in code in order to perform data conversion 
* Converted "cpcm-" custom fields to "_cpcm-" so that they don't show on post edit pages and the like.
* Update contact information
* Ensure that excluding subcategories now also works for custom taxonomies. Only show the dropdown for hierarchical taxonomies. (Tags no longer show 'Subcategory posts' dropdown.)
* Add custom CSS classes, as suggested here https://wordpress.org/support/topic/adding-css-classes-to-the-newly-displayed-menu-items

= 1.0.1 =

* Added hook wp_nav_menu_item_custom_fields for compatibility with other plug-ins adding fields to the Appearances > Menus page.
* Fix for CSS class bugs reported by brangelo in https://wordpress.org/support/topic/works-with-41-as-far-as-i-can-tell?replies=5.
* Bugfix: normal menu items that were below a menu item removed by cpcm, are now repositioned in the menu correctly.
* Bugfix for subcategories with a single post with setting remove="only if empty": "For example, I have a parent category A with sub categories A1, A2 and A3. I have all sub categories set to remove only if there are no posts. Subcat A1 displays with submenu of posts (2), subcats A2 and A3 do not display and their posts (1 each) show directly under the parent as posts links."

= 1.0 =

* Bugfix: Correctly set the menu item parents. Relevant when nesting categories with 'Create submenu' checked.
* First implementation (WIP) for request: http://wordpress.org/support/topic/replace-category-link-with-link-to-first-post?replies=10
When the menu item is marked as remove "always" or "only if empty" and there was one post, then make sure that any childen of the menu item become children of this single post.
* Implement skip-parameter
* Implemented exclusion of subcategories, useful alternative to http://wordpress.org/support/topic/is-it-possible-to-get-sub-category-post-nested

= 0.9.5 =

* Fixed http://wordpress.org/support/topic/great-job-please-contact-me?replies=2. You can now specify 0 in 'Number of posts'. That way, the category can be shown/hidden based on whether it is empty or not.
* Fixed http://wordpress.org/support/topic/post_date. Forward slash is now accepted in date formatting.

= 0.9.4 =

* Fix http://wordpress.org/support/topic/date-fields-for-menu-title-dont-work due to variable $string that has been moved out of the global scope in new Wordpress release.

= 0.9.3 =

* Fix http://wordpress.org/support/topic/issue-with-default-wordpress-sidebar-menu
* Fix http://wordpress.org/support/topic/menu-do-not-include-the-current-menu-parent-class
* Add support for auto-generated image tags, see http://wordpress.org/support/topic/images-showing-url-instead-of-actual-image

= 0.9.2 =

* Fixed bug introduced in 0.9.1 with respect to old PHP versions (5.2 and before) http://wordpress.org/support/topic/unexpected-t_function-1
* Introduced an extra ordering option 'Menu Order', as suggested here: http://wordpress.org/support/topic/extend-orderby-to-menu_order

= 0.9.1 =

* Edits for strict mode (http://wordpress.org/support/topic/edits-for-strict-mode)
* Add thumbnail option with posts (http://wordpress.org/support/topic/add-thumbnail-option-with-posts)
* PHP 5.5 preg_replace() /e modifier deprecated (http://wordpress.org/support/topic/php-55-preg_replace-e-modifier-depricated)

= 0.9 =

* Fixed CSS 'active' class problem: CSS classes are no longer copied from the parent menu item to the menu item for the posts/pages.

= 0.8 =

* Added the option to keep or remove the original menu item. Initially, the original menu item was replaced by the list of its posts, but now you can choose for yourself whether this should be done (always / only if there are no posts / never)

= 0.7.2 =

* Bugfix: Fixed invalid argument error reported by macrocurio in Plugin Support.

= 0.7.1 =

* Bugfix: Link Target, CSS Classes, Link Relationship (XFN) and Description weren't inherited from the original menu item. They are now.

= 0.7 =

* Added support for custom post types
* Fixed user_data bug
* Added date formatting options

= 0.6 =

* Added a bunch of wildcards: %post_feat_image (url only), %post_excerpt, %post_url, %post_date, %post_date_gmt, %post_status, %post_modified, %post_modified_gmt, %post_comment_count

= 0.5 =

* Enable custom taxonomies.
* Change plugin URL.

= 0.4 =

* Fix plugin bug for Tags, probably related to 3.2.2 update.
* Edit documentation
* Change some CSS to show checkbox next to label instead of above it.
* Edit text in menu item block to clarify use of custom fields.

= 0.3 =

* Extended the plugin for use of custom fields. Use a custom field with name 'my field' with wildcard %post_my_field. Note that if the post does not have this custom field, the wildcard is removed (it is not replaced by anything).

= 0.2 =

* Extended the plugin to post tags. Note that the plugin name has unfortunately _not_ been changed to reflect this extension. 

Added checkboxes, dropdowns and text fields to Appearance > Menu. It is now possible to:

* Enable/disable per taxonomy item whether you want to replace it by its posts
* Specify the (maximum) number of posts that should be displayed.
* Specify the ordering (Descending/Ascending) and the field to order by (ID, title, etc..)
* Set a title for the menu items. For this you can use the wildcards %post_title and %post_author.

== Installation ==

1. Go to plugins in your dashboard and select "Add New"
2. Search for "CPCM" or "Category Posts in Custom Menu"
3. Install and Activate the plugin

== Frequently Asked Questions ==

= How do I use it?  =

Here's a walkthrough:

<ol>
<li>Create a post with title "Post 1" and add a _new_ category "Category A"</li>
<li>Save the post</li>
<li>Go to Appearances > Menus (or via Appearance > Customize or Appearance > Editor, in WordPress 5.4 or higher)</li>
<li>Add your category named "Category A"</li>
<li>Open the menu item and check "Create submenu containing posts in this category."</li>
<li>Save the menu</li>
</ol>

If you now look at your website, "Category A" is replaced by "Post 1". Add additional posts to Category A and you will automatically see these additional posts in the menu.

= Missing CSS classes =

The CSS class 'current-post-ancestor' is not applied correctly. This is a bug in WordPress that I have reported here: https://core.trac.wordpress.org/ticket/32918 This is not something I am able to fix in the plugin, it has to be fixed in WordPress. I'm sorry for the inconvenience.

= Performance issues =

The plugin is potentially very expensive, especially when you decide to build your entire menu out of nothing but category posts. 

The solution would be to cache the menu using transients, as reported here https://wordpress.org/support/topic/performance-problem-many-database-queries?replies=11#post-7829450

> $my_cached_menu = get_transient( 'my_cached_menu');
> 
> if( $my_cached_menu === false )
> 
> {
> 
> $my_cached_menu = wp_nav_menu( ... );
> 
> set_transient( "my_cached_menu_", $my_cached_menu, YEAR_IN_SECONDS );
> 
> }
> 
> echo $my_cached_menu;

= Can't see it working in any way =

Problem: "I can't see what effect it has had. Nothing has changed (not that I can see) in the Appearance > Menu/Customize/Editor pages. It's just like before." 

If you are using a recent version of category Posts in Custom Menu and an updated version of WordPress, the problem can only occur due to your theme or other plugins conflicting with Category Posts in Custom Menu. Please disable all themes and plugins except CPCM; verify that the CPCM fields show; enable other plugins and themes one by one to determine which plugin/theme conflicts with CPCM. 

Note: A theme must either call wp_nav_menu() or apply_filters( 'wp_nav_menu_objects', ... ) for CPCM to be triggered.